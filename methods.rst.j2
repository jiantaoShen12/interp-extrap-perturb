{{ title }}
{{ '=' * (title|length) }}

{#â€” compute which methods to show â€”#}
{% set display_methods = methods %}

.. raw:: html

     <p style="margin:0.8em 0 1em; padding: 0.8em 1.2em; background: linear-gradient(135deg, rgba(139, 0, 0, 0.08) 0%, rgba(139, 0, 0, 0.03) 100%); border-left: 4px solid #8B0000; border-radius: 4px;">
       <strong>ðŸ’¡ Tip:</strong> Click the&nbsp;
       <span style="color:#8B0000;font-weight:bold;font-size:1.1em;">+</span>
       in the <em>first column</em> to expand detailed method descriptions.
     </p>

   <style>
   td.details-control { 
     width:20px; 
     text-align:center; 
     cursor:pointer;
     color: #8B0000;
     font-weight: bold;
     font-size: 1.2em;
   }
   td.details-control::before { content:'+'; }
   tr.shown td.details-control::before { content:'-'; }
   td.published { text-align:center; font-weight:bold; }
   .table-container { width:100%; overflow-x:auto; }
   a.github-link {
     display:inline-block; font-size:1.2em; vertical-align:middle; color:inherit;
   }
   a.github-link:hover { color:#8B0000; }
   
   /* Task and Model badges */
   .badge {
     display: inline-block;
     padding: 0.25em 0.6em;
     margin: 0.15em;
     font-size: 0.85em;
     font-weight: 500;
     line-height: 1;
     border-radius: 12px;
     white-space: nowrap;
   }
   
   .task-badge {
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     color: white;
     border: 1px solid rgba(102, 126, 234, 0.3);
   }
   
   .model-badge {
     background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
     color: white;
     border: 1px solid rgba(245, 87, 108, 0.3);
   }
   
   html[data-theme="light"] .task-badge {
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
   }
   
   html[data-theme="light"] .model-badge {
     background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
     box-shadow: 0 2px 4px rgba(245, 87, 108, 0.2);
   }
   
   /* Method name styling */
   td a[href*="doi.org"],
   td a[href*="nature.com"],
   td a[href*="biorxiv.org"],
   td a[href*="cell.com"] {
     font-weight: 600;
     color: #8B0000;
     text-decoration: none;
     transition: all 0.2s ease;
   }
   
   td a[href*="doi.org"]:hover,
   td a[href*="nature.com"]:hover,
   td a[href*="biorxiv.org"]:hover,
   td a[href*="cell.com"]:hover {
     color: #b30000;
     text-decoration: underline;
   }
   
   /* Published status icons */
   td.published {
     font-size: 1.2em;
   }
   
   /* Expandable description styling */
   .expanded-description {
     padding: 1em;
     background: rgba(139, 0, 0, 0.05);
     border-left: 3px solid #8B0000;
     line-height: 1.6;
     font-size: 0.95em;
   }
   
   html[data-theme="light"] .expanded-description {
     background: rgba(139, 0, 0, 0.03);
   }
   </style>

   <div class="table-container">
     <table id="methods-table" class="display" style="width:100%">
       <thead>
         <tr>
           <th></th><th>Method</th><th>Year</th><th>Task</th>
           <th>Model</th><th>Published</th><th>Code</th>
         </tr>
       </thead>
       <tbody>
       {% for m in display_methods %}
         <tr data-description="{{ m.Description|replace('\n', ' ')|replace('\r', '')|e }}">
           <td class="details-control"></td>
           <td><a href="{{ m.Publication }}">{{ m.Method }}</a></td>
           <td>{{ m.Year }}</td>

           {# â€” TASK column â€” #}
           <td>
            {%- set raw = m.Task|string -%}
            {%- if raw -%}
                {%- set clean = raw
                    | replace("'", "")
                    | replace('"', "")
                    | replace("[", "")
                    | replace("]", "")
                -%}
                {%- set parts = clean.split(',') -%}
                {%- set items = parts
                    | map('trim')
                    | reject('equalto','')
                    | reject('equalto','nan')
                    | reject('equalto','NaN')
                    | list
                -%}
                {%- if items -%}
                <div style="display: flex; flex-wrap: wrap; gap: 0.3em;">
                {%- for it in items -%}
                    <span class="badge task-badge">{{ it }}</span>
                {%- endfor -%}
                </div>
                {%- else -%}
                &nbsp;
                {%- endif -%}
            {%- else -%}
                &nbsp;
            {%- endif -%}
           </td>

           {# â€” MODEL column â€” #}
           <td>
             {%- set raw = m.Model|string -%}
             {%- if raw -%}
               {%- set clean = raw
                     | replace("'", "")
                     | replace("[", "")
                     | replace("]", "")
               -%}
               {%- set parts = clean.split(',') -%}
               {%- set items = parts
                     | map('trim')
                     | reject('equalto','')
                     | reject('equalto','nan')
                     | reject('equalto','NaN')
                     | list
               -%}
               {%- if items -%}
                 <div style="display: flex; flex-wrap: wrap; gap: 0.3em;">
                   {%- for it in items -%}
                   <span class="badge model-badge">{{ it }}</span>
                   {%- endfor -%}
                 </div>
               {%- else -%}
                 &nbsp;
               {%- endif -%}
             {%- else -%}
               &nbsp;
             {%- endif -%}
           </td>

           {# â€” Commented OUT INSPIRED BY column -
           <td>
             {%- set raw = m["Inspired by"]|string -%}
             {%- if raw -%}
               {%- set clean = raw
                     | replace("'", "")
                     | replace("[", "")
                     | replace("]", "")
               -%}
               {%- set parts = clean.split(',') -%}
               {%- set items = parts
                     | map('trim')
                     | reject('equalto','')
                     | reject('equalto','nan')
                     | reject('equalto','NaN')
                     | list
               -%}
               {%- if items -%}
                 <ul>
                   {%- for it in items -%}
                   <li>{{ it }}</li>
                   {%- endfor -%}
                 </ul>
               {%- else -%}
                 &nbsp;
               {%- endif -%}
             {%- else -%}
               &nbsp;
             {%- endif -%}
           </td>
           #}

           <td class="published">{% if m["Published"] %}<span style="color: #2E8B57;">âœ“</span>{% else %}<span style="color: #DC143C;">âœ—</span>{% endif %}</td>
            <td>
              {%- set url = m['Code Availability'] -%}
              {%- if url and url != '-' and url|lower not in ['nan', 'na', 'none'] -%}
                <a href="{{ url }}" class="github-link">
                  <i class="fab fa-github" aria-hidden="true"></i>
                  <span class="sr-only">GitHub</span>
                </a>
              {%- else -%}
                âœ—
              {%- endif -%}
            </td>
         </tr>
       {% endfor %}
       </tbody>
     </table>
   </div>

.. raw:: html

   <script>
   jQuery(function($){
      $('#methods-table').DataTable({
        order:      [[2,'desc']],
        pageLength: 10,
        lengthMenu: [5,10,20,50,200],
        scrollX:    true,
        autoWidth:  false
      });
     $('#methods-table tbody').on('click','td.details-control',function(){
       var tr = $(this).closest('tr'),
           row = $('#methods-table').DataTable().row(tr);
       if(row.child.isShown()){
         row.child.hide(); tr.removeClass('shown');
       } else {
         row.child('<div class="expanded-description">'+tr.data('description')+'</div>').show();
         tr.addClass('shown');
       }
     });
   });
   </script>

{% if title == 'All Methods' and tasks %}
.. toctree::
   :maxdepth: 1
   :titlesonly:

{#  blank line above: keeps options separate from entries #}
{%   for task, slug in tasks %}
   {{ slug }}
{%   endfor %}
{% endif %}